(self.webpackChunk=self.webpackChunk||[]).push([[637],{12989:(e,t,s)=>{s.d(t,{G:()=>r});var i=s(38983),o=s(5114),n=s(624);class r extends n.J{constructor(){super(),this._popoverActionsHandler=i.h.create(o.none)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(o.some(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}}},517:(e,t,s)=>{s.d(t,{z:()=>n});var i=s(5114),o=s(38983);class n{constructor(){this.activePopoverStack=o.h.create(i.none),this.activePopoverView=o.h.create(i.none),this._popoverActionsHandler=o.h.create(i.none)}addPopover(e,t){}getInteractionActions(e,t,s){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}}},65586:(e,t,s)=>{s.r(t),s.d(t,{createSduiBasicEngine:()=>w,default:()=>_});var i=s(5114),o=s(21038),n=s(24055),r=s(12054),a=s(78929),d=s(31903),c=s(9922),p=s(85985),l=s(77176),u=s(80358),h=s(84966),g=s(57050),m=s(86782),v=s(12989),A=s(517);const w=({sduiBufferService:e,alertState:t,getByRawAlertId:s,sendUserAction:w,environment:_,capiClient:b,sduiPopoversSupported:f=!1})=>{const C=new c.w.Keeper,S=(0,g.ls)((e=>e.toString()),s,i.fromNullable,i.map((e=>o.j.AlertId.from(e.id)))),k=e.capiEvents.pipe(p.h(u.h.is("sdui_add","sdui_remove","sdui_update")),p.h(n.e.isSduiEvent),l.U(r.al.fromSource(r.i5.CAPI))),P=f?new v.G:new A.z,y=new a.G(k,S,P),x=new d.Q({sendUserAction:w}),H=new m.U(y,x,_,b,{openAssistant(e){throw new Error("Method is not implemented")},closePopover:t=>e.pushCapiSduiEvent({kind:"sdui_remove",sduiRootId:h.t_.Id.create(t),rev:0})});return P.setPopoverActionsHandler(H),C.push(t.subscribe((e=>y.notifyAlertsChanged())),e.capiEvents.pipe(p.h(u.h.is("session_started")),p.h((e=>e.isNewSession))).subscribe((e=>y.onSessionStarted())),e.capiEvents.pipe(p.h(u.h.is("finish")),p.h((e=>0===e.revision))).subscribe((e=>y.onFirstCheckingFinished())),y),{sduiBufferService:e,sduiManager:y,sduiFeedbackService:x,dispose:()=>{C.dispose()}}},_={createSduiBasicEngine:w}},86782:(e,t,s)=>{s.d(t,{U:()=>T});var i=s(38983),o=s(72812),n=s(14454),r=s(57757),a=s(5114),d=s(31668),c=s(22232),p=s(71249),l=s(73975),u=s(57050),h=s(40151),g=s(95195),m=s(8125);class v{constructor(){this.feed=h.E,this.currentFeed=a.none,this.onFeedRemove=h.E,this.onFeedEmpty=h.E,this.header=h.E,this.footer=h.E,this.pushFeed=()=>g.right(null),this.popFeed=m.Q1,this.focusCard=()=>g.right(null),this.notifyCardFocused=m.Q1,this.dispose=m.Q1}}var A,w=s(33194),_=s(39040),b=s(55818),f=s(8901),C=s(32952),S=s(9922),k=s(41398),P=s(77176),y=s(93508),x=s(19751),H=s(23063),G=s(69627),I=s(11610),E=s(31528),U=s(26328),L=s(66268);class T{constructor(e,t,s,n,r){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=s,this.capiClient=n,this.integrationModel=r,this._focusedItem=i.h.create(a.none),this._sduiInlineCardActions=new C.xQ,this._subs=new S.w.Keeper,this.focusCard=e=>{this._focusedItem.set(a.some(e))},this.handleSduiCardAction=(e,t,s)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:s})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e),(0,u.zG)(T.getSduiFeedActions(e.actions),a.map((t=>this.integrationModel.openAssistant({type:E.WT.sdui,action:{...e,actions:t,type:L.lY.Type.sduiCardAction}}))))},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new o.x(t,e,new v,n,this._focusedItem.view(a.map((e=>e.id))));const d=this._sduiViewModel.sduiActionEvents.pipe(k.M(this._sduiInlineCardActions.pipe(P.U(a.some),y.O(a.none)))).subscribe((([e,t])=>this._nativeHandling(e,(0,u.zG)(t,a.map((e=>e.match))),(0,u.zG)(t,a.map((e=>e.cardModel)))))),c=this._sduiInlineCardActions.pipe(x.skipBy(A.eq)).subscribe((({cardAction:e})=>this._sduiViewModel.sduiActionEvents.next(e)));this._subs.push(d,c,this._sduiViewModel)}_nativeHandling({actions:e,cardId:t,sourceId:s,scope:i},o,n){(0,u.zG)(T.getSduiFeedActions(e),a.map((e=>{(0,u.zG)(n,a.map((o=>{o.onOpenExpandedViewBySduiAction(w.Oe.create(e,t,s,i))})))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"openPerformanceScore":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":return;case"closePopover":return void this.integrationModel.closePopover(e.rootPopoverId);case"openLink":return void this.environment.actions.openPopup(new d.Z(e.url));case"copyToClipboard":return void(0,u.zG)((0,r.v)(e.text),H.q(1)).subscribe();case"stopApplyingAlerts":case"upgradeToPremium":return(0,u.zG)(n,a.map((e=>e.openPlanComparisonPage({forceUtmCampaign:f.L.Place.assistantCardList})))),void(0,u.zG)(o,a.map((e=>e.hide())));case"applyAlerts":return void(0,u.zG)(o,a.map((t=>{null!=t.alert&&((0,u.zG)((0,_.UQ)(t.alert,t.plainText),(e=>new b.U_(e,(e=>t.replace(null!=e?e:"",!1)))),(t=>(0,u.zG)(a.fromNullable(t.replacements[e.alternativeIndex]),a.map((e=>t.getOnReplace(e)()))))),t.hide())})));case"closeCard":case"removeRoot":return void(0,u.zG)(o,a.map((e=>e.hide())));case"removeAlerts":return void(0,u.zG)(o,a.map((e=>{e.ignore(),e.hide()})));case"openGrammarlyGo":return void(0,u.zG)(a.sequenceArray([n,o]),a.map((([e,t])=>{if(t.alert&&(0,G.t)(t.alert.patternName)){const s=(0,_.UQ)(t.alert,t.plainText);if(s.length>0&&s[0].newText){const i=s[0].newText;e.onOpenGrammarlyGo({mode:I.w.pushRewrite,writingExpertContext:{alertId:t.alert.id,alertPname:t.alert.patternName,originalText:t.alert.text,replacementText:i},transformRange:t.alert.transformRange})}else e.onOpenGrammarlyGo({mode:I.w.ideation})}else e.onOpenGrammarlyGo({mode:I.w.ideation})})));default:(0,c.L0)(e)}}))}}T.getSduiFeedActions=(0,u.ls)(p.hX((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type)),U.nI),function(e){e.eq=l.MW({cardAction:n.t.eq})}(A||(A={}))},8901:(e,t,s)=>{s.d(t,{L:()=>i,x:()=>S});var i,o=s(40327),n=s(75099),r=s(47612),a=s(75982),d=s(66896),c=s(74660),p=s(6782),l=s(4390),u=s(2844),h=s(77176),g=s(98403),m=s(5114),v=s(8125),A=s(95574),w=s(95195),_=s(38983),b=s(81531),f=s(20641),C=s(44358);!function(e){let t;!function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsGoals="gdocsGoals",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant",e.toneSuggestion="toneSuggestion"}(t=e.Place||(e.Place={}))}(i||(i={}));class S{constructor(e,t,s,i){this._alertsList=e,this._lensState=t,this._maxAlertCategories=s,this.gnar=i,this._log=b.C8.Logging.getLogger("UpgradeViewModel"),this._advancedAlerts=_.h.create([]),this.advancedAlerts=this._advancedAlerts.view((e=>e.length>0?m.some({count:e.length,alerts:()=>this._formatLiteAlerts(S._getGroupedLiteAlerts(e))}):m.none)),this._formatLiteAlerts=e=>{const t=e.slice(0,this._maxAlertCategories),s=e.slice(this._maxAlertCategories).map((e=>e.count)).reduce(v.Sm,0);return s>0?[...t,{group:"",category:"",categoryHuman:"more...",count:s,lensName:"",bundleInfo:m.none}]:t},this._connectionId=a._.createWithRandomId("sidebar"),u.aj([this._lensState.view("currentLens").view("id").view(d.R.isPriority).view((e=>e?e=>c.bZ.isRegistered(e)&&c.bZ.isPremium(e)&&c.bZ.isPriority(e):e=>c.bZ.isRegistered(e)&&c.bZ.isPremium(e))),this._alertsList.state]).pipe(h.U((([e,t])=>l.p.reduce([],((t,{alert:s})=>(e(s)&&t.push(s),t)))(t)))).subscribe(g.wW(this._advancedAlerts))}trackUpgradeButtonShow(e){const t=this._advancedAlerts.get();(0,C.n)(this.gnar,{placement:e.placement,bannerType:e.bannerType,advancedAlerts:t,upgradeHookName:e.upgradeHookName,upgradeHookSlot:e.upgradeHookSlot}),this.gnar.assistantExpandedUpgradeHookShow(t.length,100),(0,f.Tb)().upgradeHooks.showUpgradeHook(e.upgradeHookName,e.upgradeHookSlot)}trackUpgradeButtonClick(e){const t=this._advancedAlerts.get();(0,C.Q)(this.gnar,{placement:e.placement,bannerType:e.bannerType,advancedAlerts:t,upgradeHookName:e.upgradeHookName,upgradeHookSlot:e.upgradeHookSlot}),(0,f.Tb)().upgradeHooks.clickUpgradeHook(e.upgradeHookName,e.upgradeHookSlot)}openUpgradeUrl(e){(0,o.pipe)(A.tryCatchError((()=>{(0,r.P4)().openSubscriptionDialog({currentAlerts:this._getCapiAlerts(),isAnonymousUser:!1,isFromEmail:!1,forceUtmCampaign:e})})),w.getOrElse((e=>this._log.fatal("unexpected error on open upgrade page",e))))}_getCapiAlerts(){return this._advancedAlerts.get().map((e=>(0,n.IM)(S._toRawAlertWithPossibleWrongId(e),a.Q.create(this._connectionId,0))))}static _getGroupedLiteAlerts(e){return p.Q.group(e.map((e=>e.toLiteAlert())))}static _toRawAlertWithPossibleWrongId(e){return{...e.toRawAlert(),id:(0,o.pipe)(e.rawId,m.getOrElse((()=>e.id)))}}}},57757:(e,t,s)=>{s.d(t,{v:()=>n});var i=s(44586),o=s(95195);function n(e,t=self){return new i.y((s=>{var i,n;(null===(n=null===(i=t.navigator)||void 0===i?void 0:i.clipboard)||void 0===n?void 0:n.writeText)?t.navigator.clipboard.writeText(e).then((()=>s.next(o.right(void 0)))).catch((e=>s.next(o.left(new Error(String(e)))))):s.next(o.left(new Error("The Clipboard API is not available.")))}))}}}]);