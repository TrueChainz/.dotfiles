(self.webpackChunk=self.webpackChunk||[]).push([[1196],{87982:(e,t,i)=>{i.r(t),i.d(t,{PlagiarismViewModelImpl:()=>Ae,createPlagiarismEntities:()=>ye,createPlagiarismViewModels:()=>he,setupSduiManagement:()=>u});var a=i(80358),s=i(24055),r=i(12054),n=i(55826),o=i(5114),l=i(83078),c=i(40327),d=i(85985),p=i(77176);function u(e,t,i){const u=e.view((e=>(0,c.pipe)(e,o.map((e=>e.sduiBufferService.capiEvents.pipe(d.h(a.h.is("sdui_add","sdui_remove","sdui_update")),d.h(s.e.isSduiEvent),p.U(r.al.fromSource(r.i5.CAPI))))),l.unsafeGet))).get(),g=new n.A(i,u,t),{sduiFeedbackService:m,capiClient:h}=e.view((e=>(0,c.pipe)(e,o.map((e=>({sduiFeedbackService:e.sduiFeedbackService,capiClient:e.capiClient}))),l.unsafeGet))).get();return{sduiFeedbackService:m,capiClient:h,sduiManager:g}}var g=i(31442),m=i(64998),h=i(84174),f=i(52976),v=i(56913),A=i(95195),b=i(92843),I=i(71249),P=i(95574),S=i(55415),y=i(8125),C=i(38983),w=i(99861),M=i(20594),E=i(6100),R=i(66896),k=i(74660),B=i(4890),F=i(9922),D=i(76974),L=i(23063),U=i(24713),T=i(2834),q=i(32952),G=i(40151),x=i(2844),O=i(93508),Q=i(16118),V=i(60797),j=i(16782),z=i(41398),W=i(66310),H=i(35416),Z=i(93265),_=i(73841),K=i(89770),N=i(57050),$=i(13313),J=i(54216),X=i(48015),Y=i(57757),ee=i(54466),te=i(84966),ie=i(83167),ae=i(48521),se=i(81531),re=i(35607),ne=i(20291),oe=i(52098),le=i(14592),ce=i(13299),de=i(66866),pe=i(21619),ue=i(36689),ge=i(20236),me=i(56143);const he=({sduiEngine:e,engine:t,capiProxy:i,ded:a,showPlagiarismAlerts:s,environment:r,alertProcessor:n})=>{const c=se.C8.Logging.getLogger("gDocs.PlagiarismEngine"),d=new F.w.Keeper,u=new g._(e.sduiManager.state),S={features:new Set([M.IG.Features.showCardLabelInOutcomes]),cardLayoutDensityMode:B.j.Density.minimal,shouldAnimateAlertApply:M.IG.Default.shouldAnimateAlertApply,cardVisualMode:C.h.create(B.j.CardVisualMode.RegularLightMode)},y=(0,M.Ls)((()=>A.left({kind:"default",error:new Error("should not use hydration to render sdui cards")})),t.alertsReader,S,(()=>D.of(o.none)),o.none),z=w.p.getCapabilities(y,t.alertsReader),ae=(0,N.a9)(N.yR),he=e=>ae,Ae=J.t.create(J.t.defaultLensFilters,{...J.t.defaultTextFilters,[R.R.SpecialId.Closed]:N.jv,[R.R.SpecialId.AllAlerts]:k.bZ.belongsToAllAlerts}),be=C.h.create($.A.defaultState),Ie=new oe.t(be.view("lenses"),Ae,t.sessionModel.scoreStatus),Pe={create:(e,t)=>E.v.WithSuccess.create(e,t,w.p.equatable.structEq,w.p.defaultOrd(z))},Se=Z.v.createWithExternalItems(Pe,z),ye=new K.oq(t.alertsList.state,t.alertsReader,be.view("lenses"),t.positionManager,Ie,((e,t,i,a,s)=>((e=>{(0,N.zG)(e,l.tap((e=>{d.push(u.feed.pipe(L.q(1),U.j("cards"),T.b((0,N.ls)(b.v.filter(N.jv,N.jv,(t=>t.alertIds.includes((0,N.MZ)(e.alert.id)))),b.v.foldMap(I.uZ())((0,N.a9)(I.cS),(0,N.a9)(I.cS),I.of),I.YM,l.tap((e=>{requestAnimationFrame((()=>{(0,N.zG)(u.focusCard(e.id),A.fold((e=>c.warn("Error on focusing SDUI item in a new lens",e)),N.Q1))}))}))))).subscribe())})))})(a),Se(e,t,i,a,(0,N.zG)(s,o.filter((e=>R.R.isWithAlertsId(e.id))))))),he,z,Ae),Ce=C.h.create(ye.emptyState(R.R.SpecialId.Plagiarism).patch({alertSource:k.l$.sidebar})),we=E.v.Items.getRemoveDisposedItemsTransformer(z),Me=m.i.DisablePrevNextButtons.create(z),Ee=E.v.Items.getItemsPositionsUpdateTransformer(z),Re=ie.Py.getDefaultBehavior(w.p.getActiveFocusableItem,z),ke=C.h.create(!0),Be=C.h.create(R.R.SpecialId.AllAlerts),Fe=(0,ie.u0)((()=>a.getCursor().index),ye),De=(0,ie.VC)(ye,Fe,Be,z,(()=>!1),(()=>!1)),Le=ie.sR.getStateTransformer(Re,De,z,ie.sR.getShouldAutoFocus(ke,z),N.Q1,Be),Ue=(0,N.ls)(we,P.chainLeft(Le),P.chainLeft(Me),P.chainLeft(Ee)),Te=new ee.Xx({flush:()=>a.flushChanges()},new q.xQ,y,t.alertsService,t.alertsReader,(()=>Promise.resolve()),(()=>Promise.resolve()),(0,N.zG)(t.mutedAlertsCategoriesModel,o.map((e=>({model:e,openSuggestionsManagement:()=>self.open((0,v.Um)().suggestionsSettings)})))),o.none,N.jv,w.p.getActiveFocusableItem,z,Ce,r,{bufferTransitions:!0,showGbPrompt:!1}),qe=new h.q(e.sduiFeedbackService,z,Ce,e.sduiManager,u,t.alertsReader,e.capiClient,Te,r),Ge=(0,N.zG)(ie.sR.focusFirstCardAfterBigCheck(Ce,C.h.create(i.checkingState),C.h.create(!0),{bigPaste:G.E}),(e=>ie.sR.getSideEffect(e,z))),xe=(0,le.xl)(Ce,Ae,D.of(),C.h.create(!1),C.h.create(!0)),Oe=x.aj([xe,s]).pipe(p.U((([e,t])=>t?e:N.jv))),Qe=new le.o$(t.alertsList,t.alertsReader,t.positionManager,t.alertsService,a,Ce,Oe,w.p.getActiveFocusableItem,D.of(void 0),!1),Ve=new re.o((()=>A.right(void 0))),je=(0,ce.hp)(Ce,Qe,C.h.create(16),Ve,a,c),ze=t.alertsReader,We=new pe.mN(a,Ce,Qe,t.alertsReader,w.p.getActiveFocusableItem,(e=>{const i=e.reduce(((e,i)=>(0,N.zG)(t.alertsReader.getById(i.alert.id),o.chain(k.bZ.getRawId),l.tap((t=>e.set(t,i))),o.fold((()=>e),(()=>e)))),new Map),a=Array.from(i.keys()).map((e=>n.alerts.getAlertById(e))).filter(X.fQ);if(a.length){const e=a.reduce(((e,t)=>ge.S.ordering.greaterThanOrEqual(t,e)?t:e));return o.fromNullable(i.get(te.wQ.Id.create(e.id)))}return o.none})),He=[Ge,f.P.SideEffects.createSDUIFeedSideEffect({...z,findNextAlert:(0,N.a9)(o.none),selectItemByAlert:()=>N.yR},u.feed.pipe(p.U(o.some),O.O(o.none),Q.G(),p.U((([e,t])=>(0,N.zG)(l.sequenceT(e,t),o.filter((([e,t])=>e.feedId===t.feedId)),o.map((([,e])=>({...e,cards:(0,N.zG)(e.cards,b.v.filter(N.jv,N.W8,N.W8))}))),o.alt((()=>t))))),V.oA),w.p.sduiToChecksFeedOrd(z),t.alertsReader),fe(u,z),...qe.getApplicatorEffects(),...Te.getApplicatorEffects(),ee.dv.changeAlertEffect(Ce,Te,y,w.p.getActiveFocusableItem,t.alertsReader,o.some(je),Fe,c.getLogger("CardsViewModelEffects.changeAlertEffect")),ne.R7(Ce,Ve,z,(0,N.MZ)(Te.actionEvents)),ve(qe.sduiActionEvents,D.of(!0),z),(0,ue.A7)(We,Ce,!0),de.EQ.focusMarkByActiveAlert(Ce,Qe,ze,w.p.getActiveFocusableItem,c.getLogger("MarksEffects.focusMarkByActiveAlert")),de.EQ.highlightMarkByHighlightedCard(Te,Ce,Qe,ze,z,c.getLogger("MarksEffects.highlightMarkByHighlightedCard")),(Ze=qe.sduiActionEvents,_e=me.u,{id:"sduiCopyToClipboardEffect",when:R.R.isWithAlertsId,what:H.nL.Effect.Applicator.create(Ze.pipe(p.U((e=>t=>(e.actions.forEach((e=>{"copyToClipboard"===e.type&&(0,N.zG)((0,Y.v)(e.text),L.q(1)).pipe(W.w((()=>_e.enqueue("referenceCopied")))).subscribe()})),t)))))})];var Ze,_e;const Ke=new _.l(Ce,ye,t.alertsReader,t.alertsService,He,w.p.getActiveFocusableItem,Ue),Ne=new j.t;return{...e,checksFeedFlow:()=>w.p.createCardListFlow(Te)(Te,Ce.lens(H.nL.Prism.getLens()),Ne,D.of(!1),z,w.p.listItemOrd),sduiFeedManager:u,handleSduiAction:e=>{qe.sduiActionEvents.next(e)},capabilities:z,lensState:Ce,dispose:()=>{Ke.dispose(),Te.dispose(),qe.dispose(),d.dispose()}}};function fe(e,t){return{id:"SDUIItemRemoveSideEffect",when:R.R.isWithAlertsId,what:H.nL.Effect.Applicator.create(e.feed.pipe(p.U((e=>i=>{const a=(0,N.zG)(e.cards,b.v.reduce([],((e,a)=>(0,N.zG)(i.currentLens.items.get(a.id),o.map(S.pick("value")),o.filter((0,y.Kg)((0,N.ff)(ae.o.isAnimatable),(0,N.ff)(ae.o.isAnimatingRemoval))),o.map(t.remove(N.W8,N.W8)),o.fold((()=>e),(t=>(e.push(t),e))))),N.yR,N.yR));if(a.length>0){const e=i.currentLens.items.add(a);return H.nL.Prism.getLens().compose(E.v.Prism.items).set(e,i)}return i}))))}}function ve(e,t,i){return{id:"sduiFocusEffect",when:R.R.isWithAlertsId,what:H.nL.Effect.Applicator.create(e.pipe(z.M(t),p.U((([{actions:e,cardId:t},a])=>s=>a&&Boolean(e.find((e=>"notify"===e.type&&"focus"===e.userAction)))&&H.nL.hasItems(s)?(0,N.zG)(H.In.getActiveItemOfType(w.p.isAlertRefSDUI)(s.currentLens),o.filter((e=>!["focused","removed"].includes(e.visualState.transition.type))),o.map((()=>H.nL.Prism.getLensWithItems().modify(i.selectItemById((0,N.MZ)(t)),s))),o.getOrElse((0,N.a9)(s))):s))))}}class Ae{constructor(e,t){this._plagiarismViewModelsFactory=e,this._wrapNotifyPayload=t,this.isShouldShowPlagiarismButton=C.h.create(!1),this.plagiarismButtonActions=C.h.create(o.none),this.plagiarismEngine=C.h.create(o.none)}setShowPlagiarismButton(e){this.isShouldShowPlagiarismButton.set(e)}setPlagiarismButtonActions(e){this.plagiarismButtonActions.set(o.some(e))}setPlagiarismEngine(e){this.plagiarismEngine.set(o.some(e))}openPlagiarismPage(){const e=this._plagiarismViewModelsFactory();this.setPlagiarismEngine(e),o.isSome(this.plagiarismButtonActions.get())&&(0,c.pipe)(this.plagiarismButtonActions.get(),l.unsafeGet,e.handleSduiAction)}closePlagiarismPage(){(0,c.pipe)(this.plagiarismEngine.get(),l.tap((e=>e.handleSduiAction(this._wrapNotifyPayload([{type:"disablePlagiarismCheck"}],"")))))}}var be=i(11064),Ie=i(33194),Pe=i(4694),Se=i(79880);function ye(e,t,i){const a=(e,t,i,s)=>s.forEach((s=>{switch(s.type){case"notify":return void t.sduiFeedbackService.sendUserAction(s.sourceId||i.sourceId,s.userAction);case"enablePlagiarismCheck":return void e.openPlagiarism();case"closePopover":return void t.sduiManager.popoverManager.removePopover(s.rootPopoverId);case"interactPopover":switch((0,N.zG)(t.sduiManager.popoverManager.getInteractionActions(s.rootPopoverId,s.popoverViewId,s.interaction),(s=>a(e,t,i,s))),s.interaction){case Se.fP.Fulfill:case Se.fP.Dismiss:t.sduiManager.popoverManager.removePopover(s.rootPopoverId)}return;default:return}})),s=t=>({handleGButtonPopoverAction:i=>{o.isSome(e)&&a(t,e.value,i,i.actions)}});return(0,N.zG)(e,o.fold((()=>o.none),(e=>{return o.some({plagiarismVM:new Ae((0,be.of)(t({sduiEngine:e,...i})),Pe.Zq),plagiarismButtonSub:e.sduiManager.state.pipe(p.U((e=>Ie.D1.GButton.getPlagiarismContent(e)))),popover:(a=e.sduiManager,a.popoverManager.activePopoverView.view(o.chain((e=>"component"===e.anchor.kind&&"gButton:plagiarism"===e.anchor.id?o.some(e):o.none)))),popoverActionsHandler:s});var a})))}},99861:(e,t,i)=>{i.d(t,{p:()=>a});var a,s=i(57050),r=i(35214),n=i(40327),o=i(33194),l=i(74660),c=i(7910),d=i(16892),p=i(48521),u=i(35416),g=i(6100),m=i(5114),h=i(45701),f=i(8125),v=i(22232),A=i(56370),b=i(52976),I=i(98182),P=i(74813),S=i(60984);!function(e){function t(e){return u.nL.Items.mapper((e=>e.kind),{[b.P.Kind]:e})}function i(e){return e.kind===b.P.Kind}function a(){return{viewState:()=>e=>e.kind===b.P.Kind?{view:e,kind:"alertRefSDUI"}:{}}}e.isSelectableItem=i,e.getActiveFocusableItem=e=>(e=>(0,n.pipe)(u.In.getActiveItemOfType(i)(e),m.chain(b.P.Capabilities.toAlertItem)))(e),e.checksFeedItemsMapper=t,e.isAlertRefSDUI=i,e.defaultOrd=t=>(0,r.fold)(h.getMonoid())([(0,n.pipe)(h.ordBoolean,h.contramap((0,f.ff)(b.P.Item.isBulkAcceptSDUI))),(0,n.pipe)(h.ordBoolean,h.contramap(b.P.Item.isBulkDismissSDUI)),e.getByActiveAlertPositionOrd(t)]),e.sduiToChecksFeedOrd=function(t){return i=>h.fromCompare(((a,s)=>I.e.isSDUIItem(a)&&I.e.isSDUIItem(s)?I.e.getOrd(i).compare(a,s):e.getByActiveAlertPositionOrd(t).compare(a,s)))},e.getByActiveAlertPositionOrd=e=>(0,r.fold)(h.getMonoid())([(0,n.pipe)(l.h$.ordHRange,h.contramap((t=>(0,n.pipe)(e.hasActiveAlert(t),m.map((e=>e.alert)),m.getOrElse((()=>({getHighlightRanges:()=>[{start:0,end:0}]})))))))]),e.item=()=>A.UI.Union.make("kind",{alertRefSDUI:P.p.SquashedListCard(),empty:S.Q.Empty}),e.viewState=a,e.createCardListFlow=e=>(0,c.sJ)((t=>{switch(t.key){case"empty":break;case"alertRefSDUI":e.actionEvents.next(t.action);break;default:(0,v.L0)(t)}})),e.listItemOrd=e=>h.contramap((e=>e.cell.item.view))(e).compare;const y={equals:(e,t)=>e.kind===t.kind&&d.s.eqById.equals(e,t)},C=e=>({equals:(t,i)=>{const a={[b.P.Kind]:e};return y.equals(t,i)&&(s=e=>e.kind,r=a,(e,t)=>r[s(e)].equals(e,t))(t,i);var s,r}});function w(){return{changePosition:e=>t(b.P.Capabilities.changePosition(e))}}function M(){return{completeTransition:e=>t(b.P.Capabilities.animatable.completeTransition(e)),transitionTo:e=>t(b.P.Capabilities.animatable.transitionTo(e)),changeVisualState:e=>t(b.P.Capabilities.animatable.changeVisualState(e))}}function E(){return{select:(e,i)=>t(b.P.Capabilities.select.select(e,i)),selectByAlert:(e,i,a)=>t(b.P.Capabilities.select.selectByAlert(e,i,a)),unselect:(e,i)=>t(b.P.Capabilities.select.unselect((0,s.MZ)(e),i))}}function R(){return{removeAlertFromItem:(e,i)=>t((t=>t.id===o.D1.SuccessReport.ID?t:b.P.Capabilities.removeAlert.removeAlertFromItem(e,i)(t)))}}function k(){return{remove:(e,i)=>t(b.P.Capabilities.remove.remove(e,i))}}function B(){return{updateWithAlerts:e=>t(s.yR)}}function F(){return{nextAlert:t((()=>m.none)),prevAlert:t((()=>m.none))}}function D(){return{updateUserInput:e=>t(s.yR)}}e.equatable={structEq:C(b.P.eq),idEq:C(y),visualStateEq:C(b.P.eq)},e.changePosition=w,e.disposable={isScheduledToDispose:t(b.P.Capabilities.disposable.isScheduledToDispose)},e.hidable={isHidden:t(p.o.isHidden)},e.animatableItem=M,e.hasAlertsQueries={isSelectableByAlert:e=>t(b.P.Capabilities.hasAlerts.isSelectableByAlert(e)),hasAlert:e=>t(b.P.Capabilities.hasAlerts.hasAlert(e)),hasActiveAlert:t(b.P.Capabilities.hasAlerts.hasActiveAlert)},e.changePositionStrategyQueries={useReferenceHeightOnRemove:t(s.jv)},e.select=E,e.removeAlert=R,e.remove=k,e.updateWithAlert=B,e.releaseAlert=()=>g.v.Capabilities.getAlertReleaser({...R(),...e.disposable}),e.unselectable=()=>g.v.Capabilities.getUnselectable(u.In.getActiveItem,{...E(),isScheduledToDispose:s.jv}),e.selectableByAlert=()=>g.v.Capabilities.getSelectableByAlert(u.In.getActiveItem,{...e.hasAlertsQueries,...E(),...g.v.Capabilities.getHasChecksFeed(),...e.disposable}),e.selectableById=()=>g.v.Capabilities.getSelectableById(u.In.getActiveItem,{...E(),isScheduledToDispose:s.jv}),e.updateMeta=()=>({updateMeta:g.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=e=>g.v.Capabilities.getAnimatable(e,{...R(),...M(),...g.v.Capabilities.getHasChecksFeed()}),e.hasPriorityToggle=()=>g.v.WithPriority.getHasPriorityToggle({...M(),...e.hasAlertsQueries,...e.disposable}),e.alignable={isValidToAlign:t((t=>!e.disposable.isScheduledToDispose(t)))},e.alertIterator=F,e.itemReleaser=()=>g.v.Capabilities.getItemReleaser(),e.hasAlerts=g.v.Capabilities.getHasAlerts,e.hasUserInput=D,e.verifiable=()=>g.v.Capabilities.getVerifiable(e.disposable),e.cloneable=()=>({clone:t(d.s.Capabilities.getPojoCloneable().clone)});const L={getFeatures:t((e=>b.P.Item.isBulkDismissSDUI(e)?[b.P.Features.BulkDismiss]:b.P.Item.isBulkAcceptSDUI(e)?[b.P.Features.BulkAccept]:[]))};e.getCapabilities=function(t,i){return{...a(),...e.disposable,...e.hidable,...e.equatable,...D(),...e.cloneable(),...w(),...M(),...E(),...k(),...R(),...B(),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t),...e.unselectable(t),...e.selectableByAlert(t),...e.selectableById(t),...e.updateMeta(t),...e.animatableFeed(t),...e.hasPriorityToggle(t),...e.itemReleaser(),...L,...e.verifiable(),...e.cloneable(),...e.hasAlerts(F(),i,(()=>e.isSelectableItem),{...e.hasAlertsQueries,...e.disposable})}}}(a||(a={}))},57757:(e,t,i)=>{i.d(t,{v:()=>r});var a=i(44586),s=i(95195);function r(e,t=self){return new a.y((i=>{var a,r;(null===(r=null===(a=t.navigator)||void 0===a?void 0:a.clipboard)||void 0===r?void 0:r.writeText)?t.navigator.clipboard.writeText(e).then((()=>i.next(s.right(void 0)))).catch((e=>i.next(s.left(new Error(String(e)))))):i.next(s.left(new Error("The Clipboard API is not available.")))}))}}}]);